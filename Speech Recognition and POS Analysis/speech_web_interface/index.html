<html>
    <head>
        <link href='http://fonts.googleapis.com/css?family=Noto+Sans&subset=latin,devanagari' rel='stylesheet' type='text/css'>
        <script src="jquery.min.js"></script>
        <script src="js/Chart.js"></script>
        <script type="text/javascript" src="js/d3.min.js"></script>
              <script>
        var counts = {};
        var unq=[];
        function makeIt(dataaa)
        {
            var dd=JSON.parse(dataaa);
        $("#canvasCont").html("");
$("#canvasCont").html('<canvas id="myChart" height="300px" width="300px" style="margin:auto">chart</canvas>');
Chart.defaults.global.responsive = true;
var ctx = document.getElementById("myChart").getContext("2d");
var myLineChart = new Chart(ctx).Doughnut(dd,  {
animateScale: true

});
}

function calcChart(dataaa)
{

var words=[];
                
                var types=[];
                var str="";
                  
for(var i=0;i<dataaa.length;i++)
{
words[i]=dataaa[i].token;
types[i]=dataaa[i].type;
str=str + words[i] + "  :  " + types[i] + "<br/>";
    counts[types[i]] = counts[types[i]] ? counts[types[i]]+1 : 1;
}
unq=$.unique(unq.concat(types));
var dtt="";
for(var i=0;i<unq.length;i++)
{

dtt=dtt + '{"value": ' + counts[unq[i]] + ',"color":"' + color[i] + '","highlight": "#FF5A5E","label": "' + unq[i] +'"},';

}

dtt='[' + dtt + ']';
dtt=dtt.replace(",]" , "]");

makeIt(dtt);
                $("#stormD").append(str + "<hr/>");

}
        </script>
         <script type="text/javascript">
         var color = ["#60AFFE", "#ffca3a", "#a8a4a4", "#66cdaa", "#ff4444","#ffc3a0","#daa536","#e61f44","#e7846f","#cdb0f2","#509ddd","#5ca36a","#e65d1f"];
            var host = "ws://192.168.1.23:9999/said";
            var dataa;
			console.log("Host:", host);
			
			var s = new WebSocket(host);
			
			s.onopen = function (e) {
				console.log("Socket opened.");
                //hitServer("hello How are u");
              
			};
			
			s.onclose = function (e) {
				console.log("Socket closed.");
			};
			
			s.onmessage = function (e) {
				
                 
                var dt=JSON.parse(e.data.replace(",]", "]"));
                //alert(e.data.replace(",]", "]"));
              calcChart(dt);
			};
			
			s.onerror = function (e) {
				console.log("Socket error:", e);
			};
         
          
      </script>
      
    <style>
    
    #cont
        {
       font-size: 20px;
            box-shadow: black 0px 0px 10px 0px;
            font-family: 'Noto Sans', sans-serif;
            padding: 2%;
            color: white;
            margin: auto;
            width:80%;
            height: 40%;
            margin-top: 20px;
            text-align: left;
            background-color: rgb(78, 157, 160);
            border-radius: 30px;
        }
        #status
        {
            margin: auto;
            width: 70px;
            cursor: pointer;
             
            
            border-radius: 35px;
            
        }
        .st
        {
             box-shadow: white 0px 0px 0px 0px;
        transition: all 0.5s;
        }
        .st:hover
        {
            margin: auto;
            width: 70px;
            box-shadow: white 0px 0px 10px 5px;
        }
        .animRec
        {
        animation: rec 1s infinite;
            -webkit-animation: rec 1s infinite;
        }
        
        .animNotRec
        {
       box-shadow: red 0px 0px 10px 5px;
        }
        
        @-webkit-keyframes rec {
    0%   {box-shadow: white 0px 0px 0px 0px;}
    50%  {box-shadow: white 0px 0px 10px 10px;}
            100%   {box-shadow: white 0px 0px 0px 0px;}
}

/* Standard syntax */
@keyframes rec {
    0%   {box-shadow: white 0px 0px 0px 0px;}
    50%  {box-shadow: white 0px 0px 10px 10px;}
            100%   {box-shadow: white 0px 0px 0px 0px;}
}
        

        #supcont
        {
        position:absolute;
            width: 100%;
            height: 80%;
            text-align: center;
            top: 5%;
            left: 0%;
        }
        #stormD
        {
            font-size: 20px;
            
            font-family: 'Noto Sans', sans-serif;
            padding: 2%;
            color: white;
            margin:auto;
            margin-top: 20px;
            min-height: 40%;
            width:80%;
            text-align: left;
            background-color: rgb(98, 98, 98);
            border-radius: 30px;
        }
        #supcont table
        {
            width: 100%;
            height: 100%;
        }
        #supcont table td
        {
            text-align: center;
            vertical-align: top;
width:50%;
height: 100%;
        }
        </style>    
    </head>
<body style="background-color: #c9c9c9;">
    
    
    <div id="supcont">
        
        <table>
        <tr>
        <td>
        <img id="status" src="record.png" class="st" onClick="doIt()"/>
<div id="cont"><span id="final"></span><span id="intrim" style="font-size: 14px; color: #e0dede; height: 27px; padding-top: 3px;"></span></div> 
<div id="stormD"></div> 
</td>
<td>
<div id="canvasCont" style="test-align: center; width:60%; margin:auto; margin-top: 90px;"></div>
</td>
</tr>
        </table>
        
        </div>
        
        
    
    <script>
 var fina=document.getElementById("final");
        var intrim=document.getElementById("intrim");
        var final_transcript="";
        var chk=0;
  var recognition = new webkitSpeechRecognition();
recognition.continuous = true;
recognition.interimResults = true;
recognition.lang = "en-us";

recognition.onresult = function (e) {
    var interim_transcript = '';
    
        if (typeof(e.results) == 'undefined') {
            reset();
            return;
        }
        for (var i = e.resultIndex; i < e.results.length; ++i) {
            var val = e.results[i][0].transcript;
            if (e.results[i].isFinal) {
                hitServer(val.trim());
                final_transcript += " " + val;
            } else {
                interim_transcript += " " + val;
                
            }
        }
    intrim.innerHTML = format(capitalize(interim_transcript));
    var fnl=format(capitalize(final_transcript));
        fina.innerHTML = fnl;
   
    }
function format(s) {
    return s.replace(/\n/g, '<br>');
}
        function capitalize(s) {
    return s.replace(/\S/, function(m) {
        return m.toUpperCase();
    });
}
        function doIt()
        {
        if(chk==0)
        {
recognition.start();
            //$("#status").css("box-shadow","none");
            $("#status").addClass("animRec");
             $("#status").removeClass("st");
            chk=1;
       
        }
            else
            {
                recognition.stop();
                $("#status").removeClass("animRec");
                
                setTimeout(function(){$("#status").addClass("st");},2000);
           chk=0;
            }
            
        }
        
        function hitServer(data)
        {
            s.send('{"client": "web","data": "' +  data +  '"}');
                   
        }

    </script>

</body>
</html>